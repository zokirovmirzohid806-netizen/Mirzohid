<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Professional Test Portali ‚Äî Admin Panel</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');
        :root {
            --bg: #050b18; --card: rgba(23, 32, 53, 0.98); --accent: #38bdf8;
            --text-main: #ffffff; --text-dim: #94a3b8; --glass-border: rgba(255, 255, 255, 0.1);
            --success: #10b981; --danger: #ef4444; --warning: #f59e0b;
        }
        body {
            margin: 0; font-family: 'Plus Jakarta Sans', sans-serif;
            background: radial-gradient(circle at 50% 0%, #1e293b, #0f172a, #050b18);
            color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px;
        }
        .card { background: var(--card); backdrop-filter: blur(25px); border-radius: 28px; padding: 40px; border: 1px solid var(--glass-border); width: 100%; max-width: 1000px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        
        #adminAside {
            position: fixed; right: -500px; top: 0; width: 450px; height: 100%;
            background: #0f172a; border-left: 1px solid var(--glass-border);
            padding: 25px; transition: 0.4s; z-index: 1000; overflow-y: auto; box-sizing: border-box;
        }
        #adminAside.open { right: 0; }

        .admin-cat-card { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; margin-bottom: 10px; border: 1px solid var(--glass-border); }
        .cat-actions { display: flex; gap: 5px; margin-top: 10px; }
        
        input, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid var(--glass-border); background: #1e293b; color: white; }
        button { cursor: pointer; border-radius: 10px; border: none; font-weight: 600; transition: 0.2s; }
        .btn-main { background: var(--accent); color: #000; padding: 12px 20px; }
        .btn-danger { background: var(--danger); color: #fff; padding: 8px 15px; }
        .btn-warning { background: var(--warning); color: #000; padding: 8px 15px; }
        .btn-success { background: var(--success); color: #fff; padding: 12px 20px; }
        .btn-ghost { background: rgba(255,255,255,0.05); color: #fff; padding: 10px; }
        
        .opt-btn { display: block; width: 100%; padding: 15px; margin: 10px 0; background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); color: white; text-align: left; }
        .hidden { display: none !important; }
        .q-item-admin { font-size: 12px; background: rgba(0,0,0,0.2); padding: 8px; margin-top: 5px; display: flex; justify-content: space-between; align-items: center; border-radius: 5px; }
    </style>
</head>
<body>

<div class="card">
    <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
        <h1>Test Portal</h1>
        <button onclick="toggleAdmin()" class="btn-main">‚öôÔ∏è Admin Panel</button>
    </header>

    <div id="startPage">
        <label>Bo'limni tanlang:</label>
        <select id="categorySelect"></select>
        <button onclick="startTest()" class="btn-main" style="width:100%; margin-top:20px;">Testni boshlash</button>
    </div>

    <div id="quizPage" class="hidden">
        <h2 id="questionText"></h2>
        <div id="optionsBox"></div>
    </div>

    <div id="resultPage" class="hidden" style="text-align:center">
        <h1 id="scoreDisplay"></h1>
        <button onclick="location.reload()" class="btn-main">Asosiy sahifa</button>
    </div>
</div>

<div id="adminAside">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="color:var(--accent); margin:0;">Boshqaruv</h2>
        <button onclick="toggleAdmin()" class="btn-danger">Yopish X</button>
    </div>

    <div id="adminAuth">
        <input type="password" id="adminPass" placeholder="Admin paroli">
        <button onclick="login()" class="btn-main" style="width:100%">Kirish</button>
    </div>

    <div id="adminContent" class="hidden">
        <div id="editArea" style="background:rgba(56, 189, 248, 0.1); padding:15px; border-radius:15px; margin-bottom:20px;">
            <h4 id="formTitle" style="margin-top:0;">Yangi savol qo'shish</h4>
            <input id="inCat" placeholder="Bo'lim nomi">
            <textarea id="inQ" placeholder="Savol matni"></textarea>
            <input id="inA" placeholder="A variant (To'g'ri)">
            <input id="inB" placeholder="B variant">
            <input id="inC" placeholder="C variant">
            <input id="inD" placeholder="D variant">
            <button onclick="saveData()" class="btn-success" style="width:100%">Saqlash</button>
        </div>

        <h3>Bo'limlar va Savollar</h3>
        <div id="adminCategoryList"></div>
    </div>
</div>

<script>
    // Boshlang'ich savollar (Agar xotira bo'sh bo'lsa)
    const initialData = [
        { category: "Akademik yozuv", question: "Akademik yozuv fani nimani o'rgatadi?", options: ["Ilmiy matn yozish malakalarini", "So'zlashuvni", "She'riyatni", "Rasm chizishni"], correct: 0 },
        { category: "Akademik yozuv", question: "‚ÄúHovuzning qirg‚Äòoqlarida hosil bo‚Äòlgan yupqa muz...‚Äù Parchasi qaysi matnga xos?", options: ["Badiiy matnga", "Rasmiy matnga", "Ilmiy matnga", "Publitsistik matnga"], correct: 0 }
    ];

    let fullDB = JSON.parse(localStorage.getItem('myTestDB')) || initialData;

    function toggleAdmin() { document.getElementById('adminAside').classList.toggle('open'); }
    
    function login() {
        if(document.getElementById('adminPass').value === "zokirov0712") {
            document.getElementById('adminAuth').classList.add('hidden');
            document.getElementById('adminContent').classList.remove('hidden');
            renderAdmin();
        } else alert("Parol noto'g'ri!");
    }

    function renderAdmin() {
        const list = document.getElementById('adminCategoryList');
        list.innerHTML = "";
        const cats = [...new Set(fullDB.map(x => x.category))];

        cats.forEach(cat => {
            const catQs = fullDB.filter(x => x.category === cat);
            const div = document.createElement('div');
            div.className = "admin-cat-card";
            div.innerHTML = `
                <b>üìÅ ${cat}</b> (${catQs.length} ta savol)
                <div class="cat-actions">
                    <button onclick="openCat('${cat}')" class="btn-warning">Tahrirlash</button>
                    <button onclick="deleteCat('${cat}')" class="btn-danger">O'chirish</button>
                </div>
                <div id="qs-${cat.replace(/\s/g, '')}" class="hidden" style="margin-top:10px; border-top:1px solid #444; padding-top:10px;">
                    ${catQs.map((q, idx) => `
                        <div class="q-item-admin">
                            <span>${idx+1}. ${q.question.substring(0,30)}...</span>
                            <button onclick="deleteQuestion(${fullDB.indexOf(q)})" style="background:none; color:red; cursor:pointer;">‚ùå</button>
                        </div>
                    `).join('')}
                </div>
            `;
            list.appendChild(div);
        });
        updateSelects();
    }

    function openCat(cat) {
        document.getElementById(`qs-${cat.replace(/\s/g, '')}`).classList.toggle('hidden');
        document.getElementById('inCat').value = cat;
    }

    function deleteCat(cat) {
        if(confirm(`"${cat}" bo'limidagi barcha savollar o'chib ketadi. Rozimisiz?`)) {
            fullDB = fullDB.filter(x => x.category !== cat);
            saveDB();
        }
    }

    function deleteQuestion(index) {
        fullDB.splice(index, 1);
        saveDB();
    }

    function saveData() {
        const cat = document.getElementById('inCat').value;
        const q = document.getElementById('inQ').value;
        const opts = [
            document.getElementById('inA').value,
            document.getElementById('inB').value,
            document.getElementById('inC').value,
            document.getElementById('inD').value
        ];

        if(!cat || !q || !opts[0] || !opts[1]) return alert("Ma'lumotlarni to'liq kiriting!");

        fullDB.push({ category: cat, question: q, options: opts, correct: 0 });
        saveDB();
        alert("Savol saqlandi!");
        
        // Formani tozalash
        document.getElementById('inQ').value = "";
        document.getElementById('inA').value = "";
        document.getElementById('inB').value = "";
        document.getElementById('inC').value = "";
        document.getElementById('inD').value = "";
    }

    function saveDB() {
        localStorage.setItem('myTestDB', JSON.stringify(fullDB));
        renderAdmin();
    }

    function updateSelects() {
        const cats = [...new Set(fullDB.map(x => x.category))];
        document.getElementById('categorySelect').innerHTML = cats.map(c => `<option value="${c}">${c}</option>`).join('');
    }

    // TEST QISMI
    let quiz = [], cur = 0, score = 0;

    function startTest() {
        const cat = document.getElementById('categorySelect').value;
        quiz = fullDB.filter(x => x.category === cat).sort(() => Math.random() - 0.5);
        if(quiz.length === 0) return alert("Bu bo'limda savollar yo'q!");
        
        document.getElementById('startPage').classList.add('hidden');
        document.getElementById('quizPage').classList.remove('hidden');
        showQ();
    }

    function showQ() {
        const q = quiz[cur];
        document.getElementById('questionText').innerText = q.question;
        const box = document.getElementById('optionsBox');
        box.innerHTML = "";

        // Variantlarni aralashtirish
        let mapped = q.options.map((t, i) => ({t, i}));
        mapped.sort(() => Math.random() - 0.5);

        mapped.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "opt-btn";
            btn.innerText = opt.t;
            btn.onclick = () => {
                if(opt.i === q.correct) score++;
                cur++;
                cur < quiz.length ? showQ() : finish();
            };
            box.appendChild(btn);
        });
    }

    function finish() {
        document.getElementById('quizPage').classList.add('hidden');
        document.getElementById('resultPage').classList.remove('hidden');
        document.getElementById('scoreDisplay').innerText = `Natija: ${score} / ${quiz.length}`;
        confetti({ particleCount: 150, spread: 70 });
    }

    updateSelects();
</script>
</body>
</html>
